# default config with schedutil governor replaced with powersave, to avoid crashes
# see https://github.com/NotAShelf/watt/issues/46 for more details

[[rule]]
name = "emergency-thermal-protection"
if = { is-more-than = 85.0, value = "$cpu-temperature" }
priority = 100
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "power", then = "power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.frequency-mhz-maximum = { if = "?frequency-available", then = 2000 }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }

[[rule]]
name = "critical-battery-preservation"
if.all = [
  "?discharging",
  { is-less-than = 0.3, value = "%power-supply-charge" }
]
priority = 90
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "power", then = "power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }
power.platform-profile = { if.is-platform-profile-available = "low-power", then = "low-power" }

[[rule]]
name = "high-load-performance-sustainance"
if.all = [
  { is-more-than = 0.8, value = "%cpu-usage" },
  { is-less-than = 30.0, value = "$cpu-idle-seconds" },
  { is-less-than = 75.0, value = "$cpu-temperature" },
]
priority = 80
cpu.energy-performance-bias = { if.all = [
  { not.is-driver-loaded = "intel_pstate" },
  { is-energy-performance-bias-available = "performance" }
], then = "performance" }
cpu.energy-performance-preference = { if.all = [
  { not.is-driver-loaded = "intel_pstate" },
  { is-energy-performance-preference-available = "performance" }
], then = "performance" }
cpu.governor = { if.is-governor-available = "performance", then = "performance" }
cpu.turbo = { if = "?turbo-available", then = true }

[[rule]]
name = "plugged-in-performance"
if.all = [
  { not = "?discharging" },
  { is-more-than = 0.1, value = "%cpu-usage" },
  { is-less-than = 80.0, value = "$cpu-temperature" },
]
priority = 70
cpu.energy-performance-bias = { if.all = [
  { not.is-driver-loaded = "intel_pstate" },
  { is-energy-performance-bias-available = "balance_performance" }
], then = "balance_performance" }
cpu.energy-performance-preference = { if.all = [
  { not.is-driver-loaded = "intel_pstate" },
  { is-energy-performance-preference-available = "performance" }
], then = "performance" }
cpu.governor = { if.is-governor-available = "performance", then = "performance" }
cpu.turbo = { if = "?turbo-available", then = true }

[[rule]]
name = "moderate-load-balanced-performance"
if.all = [
  { is-more-than = 0.4, value = "%cpu-usage" },
  { is-less-than = 0.8, value = "%cpu-usage" },
]
priority = 60
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "balance_performance", then = "balance_performance" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "balance_performance", then = "balance_performance" }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }

[[rule]]
name = "low-activity-power-saving"
if.all = [
  { is-less-than = 0.2, value = "%cpu-usage" },
  { is-more-than = 60.0, value = "$cpu-idle-seconds" },
]
priority = 50
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "power", then = "power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }

[[rule]]
name = "extended-idle-power-saving"
if = { is-more-than = 300.0, value = "$cpu-idle-seconds" }
priority = 40
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "power", then = "power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.frequency-mhz-maximum = { if = "?frequency-available", then = 1600 }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }

[[rule]]
name = "discharging-battery-conservation"
if.all = [
  "?discharging",
  { is-less-than = 0.5, value = "%power-supply-charge" }
]
priority = 30
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "power", then = "power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.frequency-mhz-maximum = { if = "?frequency-available", then = 2000 }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }
power.platform-profile = { if.is-platform-profile-available = "low-power", then = "low-power" }

[[rule]]
name = "battery-balanced"
if = "?discharging"
priority = 20
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "balance_power", then = "balance_power" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "power", then = "power" }
cpu.frequency-mhz-maximum = { if = "?frequency-available", then = 1800 }
cpu.frequency-mhz-minimum = { if = "?frequency-available", then = 200 }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo = { if = "?turbo-available", then = false }

[[rule]]
name = "default-balanced"
cpu.energy-performance-bias = { if.is-energy-performance-bias-available = "balance_performance", then = "balance_performance" }
cpu.energy-performance-preference = { if.is-energy-performance-preference-available = "balance_performance", then = "balance_performance" }
cpu.governor = { if.is-governor-available = "powersave", then = "powersave" }
priority = 0
